#include<iostream>
#include<conio.h>
#include<ctime>
#include<chrono>
using namespace std;
int grid[9][9] =
{
    {5, 3, 4, 6, 7, 8, 9, 1, 2},
    {6, 7, 2, 1, 9, 5, 3, 4, 8},
    {1, 9, 8, 3, 4, 2, 5, 6, 7},
    {8, 5, 9, 7, 6, 1, 4, 2, 3},
    {4, 2, 6, 8, 5, 3, 7, 9, 1},
    {7, 1, 3, 9, 2, 4, 8, 5, 6},
    {9, 6, 1, 5, 3, 7, 2, 8, 4},
    {2, 8, 7, 4, 1, 9, 6, 3, 5},
    {3, 4, 5, 2, 8, 6, 1, 7, 9}
};
void welcome()
{
    cout << "\033[34m Welcome to Sudoku! \033[0m \n";
    cout << "\033[34m Fill the empty cells (shown as 0).\033[0m";
    cout << endl<<"First cell address is row , column = 0,0 \033[0m" << endl;
}
void display() {
    cout << "Choose the action you want to perform:"<<endl;
    cout << endl<<"1 : Enter numbers";
    cout <<endl<< "2 : Get hints";
    cout << endl<<"3 : Check board";
    cout << endl<<"4 : Solve the puzzle";
    cout << endl<<"5 : Quit.";
    cout << endl << "Otion: ";
}
void printgrid() {
    for (int a = 0; a < 9; a++) {
        for (int b = 0; b < 9; b++)
            cout << grid[a][b] << " ";
        cout << endl;
    }
}
void addRandomZeros(int count) {
    while (count > 0) {
        int r = rand() % 9;
        int c = rand() % 9;
        if (grid[r][c] != 0) {
            grid[r][c] = 0;
            count--;
        }
    }
}
void copyGrid(int src[9][9], int dst[9][9]) {
    for (int i = 0; i < 9; i++)
        for (int j = 0; j < 9; j++)
            dst[i][j] = src[i][j];
}
bool findEmptyCell(int g[9][9], int& r, int& c) {
    for (r = 0; r < 9; r++)
        for (c = 0; c < 9; c++)
            if (g[r][c] == 0)
                return true;
    return false;
}
bool isValidMoveLocal(int g[9][9], int r, int c, int num) {
    for (int x = 0; x < 9; x++)
        if (g[r][x] == num || g[x][c] == num)
            return false;
    int sr = r - r % 3;
    int sc = c - c % 3;
    for (int i = 0; i < 3; i++)
        for (int j = 0; j < 3; j++)
            if (g[sr + i][sc + j] == num)
                return false;
    return true;
}
bool solveLocal(int g[9][9]) {
    int r, c;
    if (!findEmptyCell(g, r, c))
        return true;
    for (int num = 1; num <= 9; num++) {
        if (isValidMoveLocal(g, r, c, num)) {
            g[r][c] = num;
            if (solveLocal(g))
                return true;
            g[r][c] = 0;
        }
    }
    return false;
}
void giveHint() {
    int solved[9][9];
    copyGrid(grid, solved);
    if (!solveLocal(solved)) {
        cout << "Cannot give hint.\n";
        return;
    }
    while (true) {
        int r = rand() % 9;
        int c = rand() % 9;
        if (grid[r][c] == 0) {
            grid[r][c] = solved[r][c];
            cout << "Hint: (" << r << ", " << c << ") = " << solved[r][c] << endl;
            break;
        }
    }
}
bool isvalidmove(int r, int c, int num) {
    if (grid[r][c] != 0) return false;
    for (int x = 0; x < 9; x++)
        if (grid[r][x] == num || grid[x][c] == num)
            return false;
    int sr = r - r % 3;
    int sc = c - c % 3;
    for (int i = 0; i < 3; i++)
        for (int j = 0; j < 3; j++)
            if (grid[sr + i][sc + j] == num)
                return false;
    return true;
}
bool findEmpty(int& r, int& c) {
    for (r = 0; r < 9; r++)
        for (c = 0; c < 9; c++)
            if (grid[r][c] == 0)
                return true;
    return false;
}
bool solveSudoku() {
    int r, c;
    if (!findEmpty(r, c))
        return true;
    for (int num = 1; num <= 9; num++) {
        if (isvalidmove(r, c, num)) {
            grid[r][c] = num;
            if (solveSudoku())
                return true;
            grid[r][c] = 0;
        }
    }
    return false;
}
bool isValidSudoku(int a[9][9]) {
    for (int r = 0; r < 9; r++)
    {
        for (int c = 0; c < 9; c++)
        {
            if (a[r][c] != 0)
            {
                for (int k = c + 1; k < 9; k++)
                {
                    if (a[r][c] == a[r][k]) return false;
                }
            }
        }
    }
    for (int c = 0; c < 9; c++)
    {
        for (int r = 0; r < 9; r++)
        {
            if (a[r][c] != 0)
            {
                for (int k = r + 1; k < 9; k++)
                {
                    if (a[r][c] == a[k][c]) return false;
                }
            }
        }
    }
    for (int br = 0; br < 9; br += 3)
    {
        for (int bc = 0; bc < 9; bc += 3)
        {
            for (int r = 0; r < 3; r++)
            {
                for (int c = 0; c < 3; c++) {

                    if (a[br + r][bc + c] != 0) 
                    {
                        for (int r2 = r; r2 < 3; r2++) 
                        {
                            for (int c2 = (r2 == r ? c + 1 : 0); c2 < 3; c2++)
                            {
                                if (a[br + r][bc + c] == a[br + r2][bc + c2]) return false;
                            }
                        }
                    }
                }
            }
        }
    }
    return true;
}
int main()
{
    auto gameStart = chrono::high_resolution_clock::now();
    int score = 0, choice;
    welcome();
    srand(time(0));
    addRandomZeros(30);
    printgrid();
    while (true) {
        display();
        cin >> choice;
        if (choice == 1) {
            int r, c, num;
            cout << "\nEnter row:  ";
            cin >> r;
            cout << "\nEnter column:  ";
            cin >> c;
            cout << "\nEnter number:  ";
            cin >> num;
            if (isvalidmove(r, c, num)) {
                grid[r][c] = num;
                score += 10;
                cout << "\n\033[32m The number you enetered is Correct.\033[0m\n";
            }
            else {
                score -= 5;
                cout << "\n\033[31m the number you entered is Incorrect.\n Try again.\033[0m \n";
            }
            if (score >= 0)
            {
                cout << "\033[32m \nYour Score is = \033[0m" << score << endl;

            }
            else
            {
                cout << "\033[31m  \nYour Score is = \033[0m" << score << endl;
            }
            printgrid();

            int rr, cc;
            if (!findEmpty(rr, cc)) {
                cout << "Puzzle completed!\n";
                break;
            }
        }
        else if (choice == 2) {
            giveHint();
            score -= 15;
            if (score >= 0)
            {
                cout << "\033[32m \nYour Score is = \033[0m" << score << endl;
            }
            else
            {
                cout << "\033[31m  \nYour Score is = \033[0m" << score << endl;
            }
            printgrid();
            int rr, cc;
            if (!findEmpty(rr, cc)) {
                cout << "Puzzle completed!\n";
                break;
            }
        }
        else if (choice == 3) {
            if (isValidSudoku(grid))
                cout << "\033[35m Current board satisfies all rules. \033[0m\n";
            else
                cout << "\033[31m Board violates Sudoku rules. \033[0m \n";
        }
        else if (choice == 4) {
            cout << "Solving puzzle...\n";
            if (solveSudoku()) {
                cout << "\033[32m Puzzle solved successfully!\033[0m\n";
                printgrid();
                score -= 20;
                if (score >= 0)
                {
                    cout << "\033[32m \nYour Score is = \033[0m" << score << endl;
                }
                else
                {
                    cout << "\033[31m  \nYour Score is= \033[0m" << score << endl;
                }
                break;
            }
            else {
                cout << "\033[34m No solution exists.\033[0m \n";
                break;
            }
        }
        else if (choice == 5) {
            cout << "You quit. Thanks for playing.";
            break;
        }
        else cout << "Invalid choice.\n";
    }
    auto gameEnd = chrono::high_resolution_clock::now();
    chrono::duration<double> totalTime = gameEnd - gameStart;
    int totalSeconds = (int)totalTime.count();
    int minutes = totalSeconds / 60;
    int seconds = totalSeconds % 60;
    cout << "\n\033[33m Total time spent: " << minutes << " min " << seconds << " sec\033[0m\n";
    _getch();
    return 0;
}
